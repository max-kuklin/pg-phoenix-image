# postgresql.conf — pg-phoenix-image defaults
# -----------------------------------------------
# Loaded via: -c config_file=/etc/postgresql/postgresql.conf
# Override individual settings by mounting into conf.d/,
# using ALTER SYSTEM, or passing -c flags.

# --- Connection ---
listen_addresses = '*'
hba_file = '/etc/postgresql/pg_hba.conf'
idle_in_transaction_session_timeout = 300000   # 5 min
statement_timeout = 60000                      # 60s — override per-session for migrations

# --- WAL / Archiving ---
wal_level = replica
archive_mode = on
archive_command = '/bin/true'   # overridden at runtime when WALG_S3_PREFIX is set
archive_timeout = 0            # entrypoint sets this via conf.d/walg.conf when WAL-G is active

# --- pg_stat_statements ---
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.max = 5000
pg_stat_statements.track = all
track_io_timing = on

# --- Slow Query Log ---
log_min_duration_statement = -1
log_statement = 'none'
log_duration = off

# --- Logging ---
log_checkpoints = on
log_lock_waits = on
log_connections = on
log_disconnections = on
logging_collector = on
log_destination = 'stderr'
log_directory = 'log'
log_filename = 'postgresql-%a.log'
log_line_prefix = '%t %a %u@%d %h '
log_rotation_size = 100MB
log_truncate_on_rotation = on

# --- ConfigMap override mount point (must be last) ---
include_dir = 'conf.d'
